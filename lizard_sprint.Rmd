---
title: "Worked Example: Lizard Sprint Speed/Tick Parasitism"
subtitle:
output: html_notebook
---
```{r setup2, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
packages_needed <- c("ggplot2", # graphics
                     "plyr",
                     "arm", # display() etc.
                     "MASS",
                     "ggfortify",
                     "gridExtra"
                     )
pk_to_install <- packages_needed [!( packages_needed %in% rownames(installed.packages())  )]
if(length(pk_to_install)>0 ){
  install.packages(pk_to_install,repos="http://cran.r-project.org")
}
#lapply(packages_needed, require, character.only = TRUE)
library(ggplot2)
library(plyr)
library(arm)
library(MASS)
library(ggfortify)
library(gridExtra)
```

1.	Is there a relationship between hind limb length (HLL) and sprint performance (Max_25cm or Max_2m)? Is this better described by a traditional linear model (OLS) or by a GLM with some other specified error and ‘link’ functions?
  POISSON ONLY REALLY SUITABLE FOR RESPONSE DATA THAT ARE COUNTS, but OK.

2.	Does level of parasitism (#ticks) modify the relationship between hind limb length (HLL) and sprint performance (Max_25cm or Max_2m)?

3.	Is sprint speed different between treatments after accounting for both hind limb length (HLL) AND level of parasitism (#ticks)? (hint: use library(emmeans) for pairwise comparisons of covariate-adjusted means)
```{r message=FALSE, warning=FALSE}
library(readr)
lizard_sprint <- read_csv("lizard_sprint_tick.csv")

sprint.poisson <- glm(Max_2m~HLL, family= poisson(link=log), data= lizard_sprint)
sprint.ols <- glm(Max_2m~HLL, family= gaussian(link=identity), data= lizard_sprint)
#sprint.gamma <- glm(Max_2m~HLL, family=Gamma(link= "sqrt"), data= lizard_sprint)
anova(sprint.poisson,sprint.ols, test = "Chisq")
```

```{r message=FALSE, warning=FALSE, fig.height=6, fig.width=6}
p1 <- ggplot(lizard_sprint,aes(HLL,Max_2m))+geom_point() +
  geom_smooth(method="glm",colour="red",
                         method.args=list(family="poisson"(link="log")))+
  labs(title="GLM, log link, Poisson variance")

p2 <- ggplot(lizard_sprint,aes(HLL,Max_2m))+geom_point() +
  geom_smooth(method="glm",colour="red",
                         method.args=list(family="gaussian"(link="identity")))+
  labs(title="GLM, identity link, Gaussian variance")

#p3 <-ggplot(lizard_sprint,aes(HLL,Max_2m))+geom_point() +
  #geom_smooth(method="glm",colour="red",
                         #method.args=list(family="Gamma"(link="sqrt")))+
  #labs(title="GLM, square-root link, Gamma variance")

grid.arrange(p1, p2, ncol=1)
```

```{r message=FALSE, warning=FALSE}
p1+geom_point(aes(colour = factor(Ticks)))
```




```{r message=FALSE, warning=FALSE}
sprint.poisson.ticks <- glm(Max_2m~HLL+factor(Ticks), family= poisson(link=log), data= lizard_sprint)
anova(sprint.poisson.ticks)
```
```{r Accounting for treatment, HLL, and Ticks}
sprint.fullmodel.poi <- glm(Max_2m~Site+HLL+factor(Ticks), family= gaussian(link=identity), data= lizard_sprint)
anova(sprint.fullmodel)
summary(sprint.fullmodel)
```
THIS WOULD HAVE BEEN A FAR BETTER QUESTION.
Does Increased body size (age) mean higher tick load?

```{r}
tick.load <- glm(as.numeric(Ticks)~SVL, family= poisson(link=log), data= lizard_sprint)
summary(tick.load)
```
Interpretation?
```{r}
exp(0.07792)
```
```{r}
ggplot(lizard_sprint,aes(SVL,Ticks))+geom_point() +
  geom_smooth(method="glm",colour="red",
                         method.args=list(family="poisson"(link="log")))+
  labs(title="Tick Load with Body Size")

ggplot(lizard_sprint,aes(SVL,as.integer(Ticks))) +
  geom_point() +
  geom_smooth(method.args=list(family="poisson"(link="log")))+
  labs(title="Tick Load with Body Size")
```
For every unit increse in SVL, you should gain 1.08 tick.


TRY AGAIN

```{r}
ggplot(lizard_sprint, aes(x = body.size, y = fitness)) +
geom_point() +
geom_smooth(method = "glm", method.args=list(family="gaussian"(link="identity")))+
#geom_smooth(span = 1, colour = "red", se = FALSE) +
xlab("Body mass (kg)") + ylab("Lifetime fitness (No. of Lambs)") +
  ggtitle("Linear Model = Gaussian Error Structure, Identity Link")
#note negative prediction of fitness below ~3kg.

ggplot(sheepfitness, aes(x = body.size, y = fitness)) +
geom_point() +
geom_smooth(method="glm", method.args=list(family="poisson"(link="log"))) +
xlab("Body mass (kg)") + ylab("Lifetime fitness (No. of Lambs)") +
  ggtitle("Linear Model = Poisson Error Structure, Log Link")
```

